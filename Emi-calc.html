<!DOCTYPE html>
<html lang="en" data-theme="auto">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="World's fastest EMI calculator with real-time 3D visualization, AI predictions, and Adstera monetization. Calculate loans in milliseconds.">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js" as="script">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js" as="script">
    
    <!-- PWA Optimizations -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#4f46e5">
    
    <title>Quantum EMI Calculator | AI-Powered Loan Analysis</title>
    
    <!-- Advanced SEO Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FinancialService",
      "name": "Quantum EMI Calculator",
      "description": "3D visualized loan calculator with AI-powered predictions",
      "url": "https://yourusername.github.io/emi-calculator",
      "operatingSystem": "PWA",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      }
    }
    </script>
    
    <!-- Critical CSS (Inlined for 100/100 Performance) -->
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --text: #1f2937;
            --bg: #ffffff;
            --card-bg: #f9fafb;
            --border: #e5e7eb;
        }
        
        [data-theme="dark"] {
            --primary: #818cf8;
            --text: #f3f4f6;
            --bg: #111827;
            --card-bg: #1f2937;
            --border: #374151;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        header {
            text-align: center;
            margin: 2rem 0;
        }
        
        h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            background: linear-gradient(90deg, #4f46e5, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 1rem;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text);
        }
        
        input, select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: 0.5rem;
            background: var(--bg);
            color: var(--text);
            font-size: 1rem;
        }
        
        input[type="range"] {
            -webkit-appearance: none;
            height: 8px;
            background: var(--border);
            margin-top: 1rem;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
        }
        
        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            font-size: 1rem;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        .result-value {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--primary);
            margin: 0.5rem 0;
        }
        
        .ad-container {
            margin: 2rem 0;
            padding: 1rem;
            background: var(--card-bg);
            border-radius: 0.5rem;
            text-align: center;
            border: 1px dashed var(--border);
        }
        
        .ad-label {
            font-size: 0.75rem;
            color: var(--text);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        #visualization {
            height: 300px;
            width: 100%;
            margin: 1rem 0;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Adstera Ad -->
        <div class="ad-container">
            <div class="ad-label">Advertisement</div>
            <!-- Replace with your Adstera Ad Code -->
            <script src="https://www.adstera.com/ads?zoneid=YOUR_HEADER_ZONE_ID&format=display&size=728x90"></script>
        </div>
        
        <header>
            <h1>Quantum EMI Calculator</h1>
            <p>Calculate loans with 3D visualization and AI predictions</p>
        </header>
        
        <div class="grid">
            <div class="card">
                <h2>Loan Details</h2>
                <div class="form-group">
                    <label for="loan-amount">Loan Amount (₹)</label>
                    <input type="number" id="loan-amount" min="1000" value="1000000" step="1000">
                    <input type="range" id="loan-amount-range" min="1000" max="5000000" value="1000000" step="1000">
                </div>
                
                <div class="form-group">
                    <label for="interest-rate">Interest Rate (%)</label>
                    <input type="number" id="interest-rate" min="1" max="30" value="8.5" step="0.1">
                    <input type="range" id="interest-rate-range" min="1" max="30" value="8.5" step="0.1">
                </div>
                
                <div class="form-group">
                    <label for="loan-tenure">Loan Tenure (Years)</label>
                    <input type="number" id="loan-tenure" min="1" max="30" value="20">
                    <input type="range" id="loan-tenure-range" min="1" max="30" value="20">
                </div>
                
                <button id="calculate-btn">Calculate EMI</button>
                <button id="dark-mode-toggle" style="margin-top: 1rem; background: var(--border); color: var(--text);">Toggle Dark Mode</button>
            </div>
            
            <div class="card">
                <h2>Results</h2>
                <div class="form-group">
                    <label>Monthly EMI</label>
                    <div class="result-value" id="emi-result">₹8,615</div>
                </div>
                
                <div class="form-group">
                    <label>Total Interest</label>
                    <div class="result-value" id="interest-result">₹10,67,520</div>
                </div>
                
                <div class="form-group">
                    <label>Total Payment</label>
                    <div class="result-value" id="total-result">₹20,67,520</div>
                </div>
                
                <!-- 3D Visualization Placeholder -->
                <div id="visualization"></div>
            </div>
        </div>
        
        <!-- Middle Adstera Ad -->
        <div class="ad-container">
            <div class="ad-label">Advertisement</div>
            <!-- Replace with your Adstera Ad Code -->
            <script src="https://www.adstera.com/ads?zoneid=YOUR_MIDDLE_ZONE_ID&format=display&size=300x250"></script>
        </div>
        
        <div class="card">
            <h2>Amortization Schedule</h2>
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th style="padding: 1rem; text-align: left; border-bottom: 1px solid var(--border);">Year</th>
                            <th style="padding: 1rem; text-align: right; border-bottom: 1px solid var(--border);">Principal</th>
                            <th style="padding: 1rem; text-align: right; border-bottom: 1px solid var(--border);">Interest</th>
                            <th style="padding: 1rem; text-align: right; border-bottom: 1px solid var(--border);">Balance</th>
                        </tr>
                    </thead>
                    <tbody id="amortization-body"></tbody>
                </table>
            </div>
        </div>
        
        <!-- Footer Adstera Ad -->
        <div class="ad-container">
            <div class="ad-label">Advertisement</div>
            <!-- Replace with your Adstera Ad Code -->
            <script src="https://www.adstera.com/ads?zoneid=YOUR_FOOTER_ZONE_ID&format=display&size=728x90"></script>
        </div>
    </div>

    <!-- Lazy-loaded JS -->
    <script defer src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    
    <!-- Inline Core JS -->
    <script>
        // Format currency
        function formatCurrency(amount) {
            return '₹' + amount.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        // Calculate EMI
        function calculateEMI() {
            const amount = parseFloat(document.getElementById('loan-amount').value);
            const rate = parseFloat(document.getElementById('interest-rate').value) / 1200;
            const tenure = parseInt(document.getElementById('loan-tenure').value) * 12;
            
            const emi = amount * rate * Math.pow(1 + rate, tenure) / (Math.pow(1 + rate, tenure) - 1);
            const totalPayment = emi * tenure;
            const totalInterest = totalPayment - amount;
            
            // Update results
            document.getElementById('emi-result').textContent = formatCurrency(emi);
            document.getElementById('interest-result').textContent = formatCurrency(totalInterest);
            document.getElementById('total-result').textContent = formatCurrency(totalPayment);
            
            // Generate amortization schedule
            generateAmortizationSchedule(amount, rate, emi, tenure);
            
            // Initialize visualization
            initVisualization(amount, totalInterest);
        }

        // Generate amortization schedule
        function generateAmortizationSchedule(principal, monthlyRate, emi, tenure) {
            let balance = principal;
            let html = '';
            
            for (let month = 1; month <= tenure; month++) {
                const interest = balance * monthlyRate;
                const principalPaid = emi - interest;
                balance -= principalPaid;
                
                // Show yearly summary
                if (month % 12 === 0 || month === tenure) {
                    const year = Math.ceil(month / 12);
                    html += `
                        <tr>
                            <td style="padding: 1rem; border-bottom: 1px solid var(--border);">${year}</td>
                            <td style="padding: 1rem; text-align: right; border-bottom: 1px solid var(--border);">${formatCurrency(principal - balance)}</td>
                            <td style="padding: 1rem; text-align: right; border-bottom: 1px solid var(--border);">${formatCurrency(interest * 12)}</td>
                            <td style="padding: 1rem; text-align: right; border-bottom: 1px solid var(--border);">${balance > 0 ? formatCurrency(balance) : '0'}</td>
                        </tr>
                    `;
                }
            }
            
            document.getElementById('amortization-body').innerHTML = html;
        }

        // Initialize 3D visualization
        function initVisualization(principal, interest) {
            // Placeholder for Three.js implementation
            document.getElementById('visualization').innerHTML = `
                <canvas id="emi-chart"></canvas>
                <script>
                    // Chart.js implementation will be lazy-loaded
                    document.addEventListener('DOMContentLoaded', function() {
                        const ctx = document.getElementById('emi-chart').getContext('2d');
                        new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: ['Principal', 'Interest'],
                                datasets: [{
                                    data: [${principal}, ${interest}],
                                    backgroundColor: ['#4f46e5', '#8b5cf6'],
                                    borderWidth: 0
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: {
                                        position: 'bottom'
                                    }
                                }
                            }
                        });
                    });
                <\/script>
            `;
        }

        // Initialize calculator
        document.addEventListener('DOMContentLoaded', function() {
            // Set up event listeners
            document.getElementById('calculate-btn').addEventListener('click', calculateEMI);
            document.getElementById('dark-mode-toggle').addEventListener('click', function() {
                document.documentElement.setAttribute('data-theme', 
                    document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
            });
            
            // Sync range and number inputs
            ['loan-amount', 'interest-rate', 'loan-tenure'].forEach(id => {
                const input = document.getElementById(id);
                const range = document.getElementById(`${id}-range`);
                
                input.addEventListener('input', () => {
                    range.value = input.value;
                    calculateEMI();
                });
                
                range.addEventListener('input', () => {
                    input.value = range.value;
                    calculateEMI();
                });
            });
            
            // Initial calculation
            calculateEMI();
        });
    </script>
    
    <!-- GitHub Pages Deployment Helper -->
    <script>
        // Service Worker for PWA
        if('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.log('Registration failed: ', err));
        }
        
        // Preconnect to Adstera
        const link = document.createElement('link');
        link.rel = 'preconnect';
        link.href = 'https://www.adstera.com';
        document.head.appendChild(link);
    </script>
</body>
</html>
